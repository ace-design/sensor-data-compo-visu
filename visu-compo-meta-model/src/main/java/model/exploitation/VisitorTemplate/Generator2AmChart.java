package model.exploitation.VisitorTemplate;

import exception.VisitorException;
import metaclasses.Column;
import metaclasses.Resource;
import metaclasses.Visualization;
import org.stringtemplate.v4.ST;
import utils.NameCorrectness;

import java.util.UUID;

import static java.util.UUID.randomUUID;

/**
 * Created by ivan on 17/07/2014.
 */
public class Generator2AmChart extends Generator{

    @Override
    public void visit(Visualization visualization) throws VisitorException {
        //Chart
        ST st_chart = Generator.amgroup.getInstanceOf("amchart");
        st_chart.add("chartname", visualization.getName());
        st_chart.add("dataname", "data_"+visualization.getName());
        st_chart.add("categoryname", "index_"+visualization.getName());

        for(Resource resource : visualization.getResources()){
            resource.accept(this);
            st_chart.add("graphs",symbolTable.get(visualization.getName()+resource.getUrl()));
        }

        symbolTable.put(visualization.getName(),st_chart);
    }

    @Override
    public void visit(Resource resource) throws VisitorException {
        String graphName = "mygraph_"+NameCorrectness.format(randomUUID().toString());

        //Graph
        ST st_graph = Generator.amgroup.getInstanceOf("graph");
        st_graph.add("chartname", resource.getVisualization().getName());
        st_graph.add("graphname", graphName);
        st_graph.add("seriename", resource.getSerie().getName());

        //Find the right specialization pattern for the wanted widget
        ST st_graphspe = amgroup.getInstanceOf("graph"+resource.getVisualization().getWidgetName().replace(" ", ""));
        st_graphspe.add("graphname", graphName);
        st_graph.add("graphspe", st_graphspe);

        symbolTable.put(resource.getVisualization().getName()+resource.getUrl(),st_graph);
    }
}
