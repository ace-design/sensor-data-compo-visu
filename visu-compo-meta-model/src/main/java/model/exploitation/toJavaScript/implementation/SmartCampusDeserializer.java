package model.exploitation.toJavaScript.implementation;

import metaclasses.resource.AtomicResource;
import metaclasses.resource.CompositeResource;
import metaclasses.resource.Element;
import metaclasses.resource.Resource;
import model.exploitation.toJavaScript.metaclasse.Source;
import org.json.JSONArray;
import org.json.JSONObject;
import utils.FileOperation;
import model.exploitation.toJavaScript.interfaces.DataDeserializer;

import java.util.ArrayList;
import java.util.List;

/**
 * Created by Ivan Logre on 01/07/2014.
 */
public class SmartCampusDeserializer implements DataDeserializer {

    //TODO comment
    public List<Source> serializedResource2Pivot(AtomicResource atomicResource){
        List<Source> result = new ArrayList<>();
        String serialized = "";
        try {
            serialized = FileOperation.getStringFromFile(atomicResource.getUrl());
        } catch (Exception e) {e.printStackTrace();} //TODO
        for(Element e : atomicResource.getValues()) {
            Source source = new Source(e.getName() + atomicResource.getName());
            JSONObject rootSource = new JSONObject(serialized);
            JSONArray values = rootSource.getJSONArray("values");
            for (int i = values.length() - 1; i >= 0; i--) {
                JSONObject v = values.getJSONObject(i);
                source.put(v.getLong(atomicResource.getKey().getName()), v.getDouble(e.getName()));  // allow to compare factorize data set with different basetime
            }
            result.add(source);
        }
        return result;
    }

    @Override
    public List<Source> serializedResource2Pivot(CompositeResource compositeResource) {
        return null; //TODO
    }

    @Override
    public List<Source> serializedResource2Pivot(Resource resource) {
        switch(resource.getClass().getSimpleName()){
            case "CompositeResource" : return serializedResource2Pivot((CompositeResource)resource);
            case "AtomicResource" : return serializedResource2Pivot((AtomicResource)resource);
        }
        return null;
    }
}
